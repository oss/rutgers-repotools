#!/usr/bin/python
"""
A package publishing script. This takes a package and does dependency checking
to see if the addition of the new package would cause dependency errors. If
there are none, this adds the entry into the Rutgers repository database.
"""

import argparse
import repotools

from repotools import AppHandler

class Pusher(AppHandler):
    """
    Does pushing to repositories.
    """
    def __init__(self, config_file=None, force=False, test=False,
                 verbose=False):
        """
        Handles the initialization.
        """
        AppHandler.__init__(self)


if __name__ == '__main__':
    os.umask(002)

    # Set up command line options
    parser = argparse.ArgumentParser(
            prog='pushpackage',
            description='Publishes packages to Rutgers repositories.',
            epilog='Made with love by Open System Solutions.')
    parser.add_argument(
            'repository',
            help='A repository formatted as <distro><version>-<reponame>',
            nargs='+')
    parser.add_argument(
            '-f',
            '--force',
            action='store_true',
            help='Do not do dependency checking.')
    parser.add_argument(
            '-t',
            '--test',
            action='store_true',
            help='Do dependency checking and exit without an actual push.')
    parser.add_argument(
            '-v',
            '--verbose',
            action='store_true',
            help='Use verbose output.')
    parser.add_argument(
            '-c',
            '--config_file',
            action='store',
            default='/etc/rutgers-repotools.cfg',
            help='Specify config file. Defaults to /etc/rutgers-repotools.cfg.')

    # Parse the command-line arguments
    try:
        pusher = Pusher(parser.parse_args().__dict__())
        pusher.push()
    except UserError as e:
        pass
    except DependencyError as e:
        pass
    except ConfigurationError as e:
        pass
